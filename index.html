
<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>
   Student Subject Result
  </title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&amp;display=swap" rel="stylesheet"/>
  <style>
   body {
      margin: 0;
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(to right, #d8eefe, #e0f7fa);
      padding: 20px;
    }

    .header {
      text-align: center;
      margin-bottom: 30px;
      color: #0f172a;
      background: linear-gradient(to right, #ffe4e6, #3b82f6);
      padding: 25px 10px;
      border-radius: 20px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.2);
      color: white;
    }

    .college-logo {
      width: 120px;
      height: 120px;
      margin: 0 auto 15px;
      background: white;
      border-radius: 50%;
      padding: 10px;
      box-shadow: 0 8px 25px rgba(0,0,0,0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      transition: transform 0.3s;
    }

    .college-logo:hover {
      transform: scale(1.05);
    }

    .college-logo img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 50%;
    }

    .header h1 {
      margin: 10px 0 5px;
      font-size: 24px;
    }

    .header h3 {
      margin: 0;
      font-weight: 500;
      font-size: 18px;
      opacity: 0.95;
    }

    .college-location {
      font-size: 15px;
      margin-bottom: 8px;
    }

    .portal-title {
      background-color: #facc15;
      color: #1e293b;
      font-weight: 600;
      padding: 8px;
      border-radius: 12px;
      box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
      margin-top: 10px;
    }

    .container {
  max-width: 500px;
  margin: 30px auto;
  background: #fef9c3; /* Light Yellow */
  padding: 30px;
  border-radius: 20px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.1);
  text-align: center;
}


    h1 {
      color: #1e3a8a;
      font-size: 20px;
      margin-bottom: 25px;
    }

    select, input, button {
      margin: 10px 0;
      padding: 14px 16px;
      font-size: 15px;
      width: 100%;
      border-radius: 12px;
      border: 1px solid #cbd5e1;
      transition: 0.3s ease;
    }

    select:focus, input:focus {
      border-color: #3b82f6;
      outline: none;
      box-shadow: 0 0 5px #93c5fd;
    }

    button {
      background-color: #2563eb;
      color: white;
      font-weight: 600;
      border: none;
      cursor: pointer;
    }

    button:hover {
      background-color: #1d4ed8;
    }

    .loading-container {
      display: none;
      margin-top: 15px;
      font-size: 16px;
      font-weight: bold;
      color: #1d4ed8;
      animation: pulse 1s infinite;
    }

    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.4; }
      100% { opacity: 1; }
    }

    .result-card {
      margin-top: 25px;
      background-color: #e0f2fe;
      padding: 20px;
      border-radius: 16px;
      text-align: left;
      color: #1e3a8a;
      font-size: 16px;
      line-height: 1.6;
      border-left: 6px solid #2563eb;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    }
  

/* Animation and table styles added for better UX */
@keyframes fadeSlideIn {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}
.result-card { animation: fadeSlideIn 0.6s ease; }
.result-table { width: 100%; border-collapse: collapse; margin-top: 10px; }
.result-table th { background-color: #2563eb; color: #fff; padding: 8px; border: 1px solid #cbd5e1; text-align:left; }
.result-table td { padding: 8px; border: 1px solid #e6eef8; }
.result-table tr:nth-child(even) { background-color: #f1f5f9; }
.notice { background-color: #fef3c7; border-left: 5px solid #f59e0b; padding: 10px; margin: 10px 0; color: #78350f; border-radius:6px;}
  </style>
 </head>
 <body>
  <div class="header">
   <div class="college-logo">
    <img alt="College Logo" src="https://raw.githubusercontent.com/Siddaram76/student_result_website/main/logo.jpg"/>
   </div>
   <h3>
    Kalyana Karnataka Education Society
   </h3>
   <h1>
    MILLENNIUM COMPOSITE PRE-UNIVERSITY COLLEGE
   </h1>
   <p class="college-location">
    Kalaburgi, Karnataka
   </p>
   <div class="portal-title">
    <marquee behavior="scroll" direction="left" scrollamount="6">
     Unit Test &amp; Monthly Test Results
    </marquee>
   </div>
  </div>
  <div style="background-color: #fef3c7; border-left: 5px solid #f59e0b; padding: 10px; margin: 10px 0; color: #78350f; font-weight: bold;">
   ðŸ“¢ Latest Notification:
   <ul style="margin: 5px 0; padding-left: 20px;">
    <li>
     Unit Test 1 Results are now available.
    </li>
    <li>
     Monthly Test scheduled for 25th August.
    </li>
    <li>
     Notes for Economics uploaded in the Notes section.
    </li>
   </ul>
  </div>
  <div class="container">
   <h1>
    Check Your Subject Result
   </h1>
   <select id="year">
    <option value="">
     Select Year
    </option>
    <option value="1">
     1st Year
    </option>
    <option value="2">
     2nd Year
    </option>
   </select>
   <select id="subject">
    <option value="">
     Select Subject
    </option>
    <option value="Economics">
     Economics
    </option>
    <option value="Business">
     Business
    </option>
    <option value="Accountancy">
     Accountancy
    </option>
    <option value="Computer">
     Computer Science
    </option>
    <option value="Physics">
     Physics
    </option>
    <option value="Chemistry">
     Chemistry
    </option>
    <option value="Maths">
     Maths
    </option>
    <option value="Biology">
     Biology
    </option>
   </select>
   <select id="testType">
    <option value="">
     Select Test Type
    </option>
    <option value="Unit">
     Unit Test
    </option>
    <option value="Monthly">
     Monthly Test
    </option>
   </select>
   <input id="rollNumber" placeholder="Enter Roll Number" type="text"/>
   <button onclick="getResult()">
    Search Result
   </button>
   <div class="loading-container">
    Loading...
   </div>
   <div id="result">
   </div>
  </div>
  <script>
   const sheetId = '1QT6ipufgUfd-nLr5tm5yro7FEhuiHg-jf_0alnJKI8c';
const apiKey = 'AIzaSyDF9StQ_lOLDxPEzvj7c2I9oJSD0yE5-tk';

function findHeaderIndex(headers, pattern) {
  pattern = pattern.toLowerCase();
  for (let i = 0; i < headers.length; i++) {
    const h = (headers[i] || '').toString().toLowerCase();
    if (h === pattern || h.includes(pattern) || (pattern === 'roll_no' && /roll/.test(h))) return i;
  }
  return -1;
}

async function getResult() {
  const year = document.getElementById("year").value;
  const subject = document.getElementById("subject").value;
  const roll = document.getElementById("rollNumber").value.trim();
  const resultDiv = document.getElementById("result");
  const loadingDiv = document.querySelector(".loading-container");
  const testType = document.getElementById("testType").value;
  const sheetName = `${year}_${subject}_${testType}`;

  resultDiv.style.display = "none";
  loadingDiv.style.display = "block";
  resultDiv.innerHTML = "";

  if (!year || !subject || !testType || !roll) {
    loadingDiv.style.display = "none";
    resultDiv.innerHTML = "<p>Please select year, subject, test type, and enter your roll number.</p>";
    resultDiv.style.display = "block";
    return;
  }

  const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${encodeURIComponent(sheetName)}?key=${apiKey}`;

  try {
    const response = await fetch(url);
    if (!response.ok) {
      throw new Error('Network response was not OK: ' + response.status);
    }
    const data = await response.json();

    if (!data.values || data.values.length < 2) {
      throw new Error("No data found in the sheet. Make sure the sheet/tab exists and is public.");
    }

    const rows = data.values;
    const headers = rows[0].map(h => (h||'').toString().trim());
    // find common columns
    const rollIndex = findHeaderIndex(headers, 'roll');
    const nameIndex = findHeaderIndex(headers, 'student name') !== -1 ? findHeaderIndex(headers, 'student name') : findHeaderIndex(headers, 'name');
    const fatherIndex = findHeaderIndex(headers, 'father');

    if (rollIndex === -1 || nameIndex === -1) {
      loadingDiv.style.display = "none";
      resultDiv.innerHTML = "<p>Sheet headers are missing required columns (ROLL_NO and Student Name). Please check the sheet.</p>";
      resultDiv.style.display = "block";
      return;
    }

    const student = rows.find((r, i) => i > 0 && ( (r[rollIndex]||'').toString().trim() === roll ) );

    loadingDiv.style.display = "none";

    if (!student) {
      resultDiv.innerHTML = `<p>No result found for Roll Number: ${roll}</p>`;
      resultDiv.style.display = "block";
      return;
    }

    // Monthly Test handling (dynamic subject headers)
    if (testType.toLowerCase() === 'monthly') {
      // find indices for total, percentage, grade (case-insensitive)
      const totalIndex = headers.findIndex(h => /total/i.test(h));
      const percIndex = headers.findIndex(h => /perc/i.test(h));
      const gradeIndex = headers.findIndex(h => /grade/i.test(h));

      // determine subject columns as those between fatherIndex+1 and before totalIndex (if total exists),
      // otherwise treat middle columns (exclude roll,name,father,grade,percentage,total)
      let excluded = new Set([rollIndex, nameIndex, fatherIndex, totalIndex, percIndex, gradeIndex].filter(i => i >= 0));
      let subjectCols = [];
      for (let i = 0; i < headers.length; i++) {
        if (!excluded.has(i)) subjectCols.push(i);
      }

      // If there are more than 6, take the first 6 (as user said number fixed)
      if (subjectCols.length > 6) subjectCols = subjectCols.slice(0, 6);

      // Build table rows
      let tableRows = subjectCols.map(i => {
        const subjName = headers[i] || ('Subject ' + (i+1));
        const mark = student[i] !== undefined ? student[i] : '';
        return `<tr><td>${subjName}</td><td>${mark}</td></tr>`;
      }).join('');

      const totalVal = (totalIndex >= 0 ? student[totalIndex] : '');
      const percVal = (percIndex >= 0 ? student[percIndex] : '');
      const gradeVal = (gradeIndex >= 0 ? student[gradeIndex] : '');

      resultDiv.innerHTML = `
        <div class="result-card">
          <h3>Name: ${student[nameIndex] || ''}</h3>
          <p>Father Name: ${student[fatherIndex] || ''}</p>
          <p>Test Type: Monthly Test</p>
          <table class="result-table" role="table" aria-label="Monthly marks">
            <thead><tr><th>Subject</th><th>Marks</th></tr></thead>
            <tbody>
              ${tableRows}
            </tbody>
          </table>
          <p><strong>Total:</strong> ${totalVal}</p>
          <p><strong>Percentage:</strong> ${percVal}</p>
          <p><strong>Grade:</strong> ${gradeVal}</p>
        </div>
      `;
      resultDiv.style.display = "block";
      return;
    }

    // Unit Test handling
    // find chapter, marks, grade indices
    const chapterIndex = headers.findIndex(h => /chapter/i.test(h));
    const marksIndex = headers.findIndex(h => /mark/i.test(h));
    const gradeIndex = headers.findIndex(h => /grade/i.test(h));

    const chapterInfo = (chapterIndex !== -1 && student[chapterIndex]) ? `<p>Chapter: ${student[chapterIndex]}</p>` : "";

    resultDiv.innerHTML = `
      <div class="result-card">
        <h3>Name: ${student[nameIndex] || ''}</h3>
        <p>Father Name: ${student[fatherIndex] || ''}</p>
        <p>Subject: ${subject}</p>
        <p>Test Type: Unit Test</p>
        ${chapterInfo}
        <p>Marks: ${marksIndex >= 0 ? student[marksIndex] : ''}</p>
        <p>Grade: ${gradeIndex >= 0 ? student[gradeIndex] : ''}</p>
      </div>
    `;
    resultDiv.style.display = "block";

  } catch (err) {
    loadingDiv.style.display = "none";
    console.error(err);
    resultDiv.innerHTML = `<p>Error: ${err.message}</p>`;
    resultDiv.style.display = "block";
  }
}
  </script>
  <footer style="text-align:center; margin-top:40px; color:#334155; font-size:14px;">
   <hr style="margin-bottom: 10px;"/>
   <p>
    <strong>
     Developed and Maintained by Siddaram Diggikar, Dept. of Computer science
    </strong>
   </p>
  </footer>
 </body>
</html>
